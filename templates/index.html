<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Recolekt</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body {
      font-family: Arial, Helvetica, sans-serif;
      max-width: 780px;
      margin: 40px auto;
      padding: 0 16px;
    }
    input[type=text] {
      width: 78%;
      padding: 10px;
      margin-right: 8px;
    }
    button {
      padding: 10px 16px;
    }
    img {
      max-width: 100%;
      height: auto;
      margin-top: 12px;
    }
    .info {
      margin-top: 12px;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 6px;
    }
  </style>
</head>
<body>
  <h1>Recolekt â€” Reel thumbnail & download</h1>

  <form id="frm">
    <input type="text" id="url" name="url" placeholder="Paste Instagram Reel URL" required />
    <button type="submit">Fetch</button>
  </form>

  <div id="result"></div>

  <script>
    const form = document.getElementById('frm');
    const result = document.getElementById('result');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      result.innerHTML = 'Working...';
      const url = document.getElementById('url').value.trim();
      if (!url) { 
        result.innerHTML = 'Provide a URL'; 
        return; 
      }

      try {
        // Prepare form data
        const data = new FormData();
        data.append('url', url);

        // POST to backend
        const resp = await fetch('/', { method: 'POST', body: data });

        // Parse JSON safely
        let json;
        try {
          json = await resp.json();
        } catch (_) {
          result.innerHTML = `<pre style="color:red">Invalid response from server</pre>`;
          return;
        }

        if (!resp.ok) {
          result.innerHTML = `<pre style="color:red">${JSON.stringify(json, null, 2)}</pre>`;
          return;
        }

        // Build UI
        let html = `<div class="info"><strong>Title:</strong> ${json.title || '(no title)'}<br>`;
        html += `<strong>Duration:</strong> ${json.duration || 'n/a'}s<br>`;
        if (json.thumbnail) html += `<img src="${json.thumbnail}" alt="thumbnail">`;
        if (json.download) html += `<p><a href="${json.download}">Download video</a></p>`;
        html += `</div>`;
        result.innerHTML = html;

      } catch (err) {
        result.innerHTML = `<pre style="color:red">${err.toString()}</pre>`;
      }
    });
  </script>
</body>
</html>
